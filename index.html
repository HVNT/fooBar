<!DOCTYPE html>
<html lang="en-US">

	<head>
		<title>CS 4460 Project</title>
		<meta charset="UTF-8">
		<meta name="author" content="FooBar">
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
		<script type="text/javascript" src="http://code.highcharts.com/highcharts-3d.js"></script>
		<script type="text/javascript" src="scripts/papaparse.min.js"></script>
		
		<style type="text/css">
			#container1, #container2 {
				width: 800px;
				height: 400px;
				margin: 0 auto;
				padding-bottom: 50px
			}
			
			#container1 {
				position: relative;
			}
			
			#master-container {
				position: absolute;
				top: 300px;
				height: 100px;
				width: 100%;
			}
			
			#container3 {
				height: 300px;
			}
		</style>
	</head>
	
	<body>
		<div id="container1">
			<div id="detail-container"></div>
			<div id="master-container"></div>
		</div>
		<div id="container2"></div>
		<div id="container3"></div>
		
		<script type="text/javascript">
			$.get('data/combine.csv', function(csv) {
				var combine = Papa.parse(csv);
				
				var comparison1 = 
					(parseFloat(combine.data[1][6]) + parseFloat(combine.data[1][7])) *
					(6/parseFloat(combine.data[1][5]) + 7/parseFloat(combine.data[1][8]) + 262/parseFloat(combine.data[1][9]));
				var comparison2 = 
					(parseFloat(combine.data[2][6]) + parseFloat(combine.data[2][7])) *
					(6/parseFloat(combine.data[2][5]) + 7/parseFloat(combine.data[2][8]) + 262/parseFloat(combine.data[2][9]));
				
				var data, detailChart;
				
				data = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];
				
				function createDetail(masterChart) {
					var detailData = [], detailStart = Date.UTC(1999, 0);
					
					$.each(masterChart.series[0].data, function () {
						if (this.x >= detailStart) {
							detailData.push(this.y);
						}
					});
					
					detailChart = $('#detail-container').highcharts({
						chart: {
							marginBottom: 120,
							reflow: false,
							marginLeft: 50,
							marginRight: 20,
							style: {
								position: 'absolute'
							}
						},
						credits: {
							enabled: false
						},
						title: {
							text: 'Overall NFL Combine Statistics'
						},
						subtitle: {
							text: 'Select an area by dragging across the lower chart'
						},
						xAxis: {
							type: 'datetime'
						},
						yAxis: {
							title: {
								text: null
							},
							maxZoom: 0.1
						},
						tooltip: {
							formatter: function () {
								return Highcharts.numberFormat(this.points[0].y, 2);
							},
							shared: true
						},
						legend: {
							enabled: false
						},
						plotOptions: {
							series: {
								marker: {
									enabled: false,
									states: {
										hover: {
											enabled: true,
											radius: 3
										}
									}
								}
							}
						},
						series: [{
							pointStart: detailStart,
							pointInterval: 60 * 60 * 24 * 365 * 1000 + 20000000,
							data: detailData
						}],
					}).highcharts();
				}
				
				function createMaster() {
					$('#master-container').highcharts({
						chart: {
							reflow: false,
							borderWidth: 0,
							backgroundColor: null,
							marginLeft: 50,
							marginRight: 20,
							zoomType: 'x',
							events: {
								selection: function (event) {
									var extremesObject = event.xAxis[0],
										min = extremesObject.min,
										max = extremesObject.max,
										detailData = [],
										xAxis = this.xAxis[0];
										
									$.each(this.series[0].data, function () {
										if (this.x > min && this.x < max) {
											detailData.push([this.x, this.y]);
										}
									});
									
									xAxis.removePlotBand('mask-before');
									xAxis.addPlotBand({
										id: 'mask-before',
										from: Date.UTC(1999, 0),
										to: min,
										color: 'rgba(0, 0, 0, 0.2)'
									});

									xAxis.removePlotBand('mask-after');
									xAxis.addPlotBand({
										id: 'mask-after',
										from: max,
										to: Date.UTC(2014, 0),
										color: 'rgba(0, 0, 0, 0.2)'
									});
									
									detailChart.series[0].setData(detailData);
									
									return false;
								}
							}
						},
						title: {
							text: null
						},
						xAxis: {
							type: 'datetime',
							showLastTickLabel: true,
							plotBands: [{
								id: 'mask-before',
								from: Date.UTC(1999, 0),
								to: Date.UTC(2014, 0),
								color: 'rgba(0, 0, 0, 0.2)'
							}],
							title: {
								text: null
							}
						},
						yAxis: {
							gridLineWidth: 0,
							labels: {
								enabled: false
							},
							title: {
								text: null
							},
							min: 0.6,
							showFirstLabel: false
						},
						tooltip: {
							formatter: function () {
								return false;
							}
						},
						legend: {
							enabled: false
						},
						credits: {
							enabled: false
						},
						plotOptions: {
							series: {
								fillColor: {
									linearGradient: [0, 0, 0, 70],
									stops: [
										[0, Highcharts.getOptions().colors[0]],
										[1, 'rgba(255,255,255,0)']
									]
								},
								lineWidth: 1,
								marker: {
									enabled: false
								},
								shadow: false,
								states: {
									hover: {
										lineWidth: 1
									}
								},
								enableMouseTracking: false
							}
						},
						series: [{
							type: 'area',
							pointInterval: 60 * 60 * 24 * 365 * 1000 + 20000000,
							pointStart: Date.UTC(1999, 0),
							data: data
						}],
					}, function (masterChart) {
						createDetail(masterChart);
					}).highcharts();
				}
				
				createMaster();
				
				$('#container2').highcharts({
					chart: {
						type: 'area',
						spacingBottom: 30
					},
					title: {
						text: 'Player Comparison'
					},
					xAxis: {
						categories: combine.data[0].slice(3,10)
					},
					yAxis: {
						title: {
							text: null
						}
					},
					tooltip: {
						formatter: function () {
							return '<b>' + this.series.name + '</b><br/>' +
								this.x + ': ' + this.y;
						}
					},
					plotOptions: {
						area: {
							fillOpacity: 0.5
						}
					},
					credits: {
						enabled: false
					},
					series: [{
						name: combine.data[1][1],
						data: combine.data[1].slice(3,10).map(Number)
					}, {
						name: combine.data[2][1],
						data: combine.data[2].slice(3,10).map(Number)
					}]
				});
				
				$('#container3').highcharts({
					chart: {
						type: 'pie',
						options3d: {
							enabled: true,
							alpha: 45,
							beta: 0
						}
					},
					title: {
						text: 'Likelihood to Succeed in the NFL'
					},
					tooltip: {
						pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							depth: 35,
							dataLabels: {
								enabled: true,
								format: '{point.name}'
							}
						}
					},
					credits: {
						enabled: false
					},
					series: [{
						type: 'pie',
						name: 'Percentage',
						data: [
							[combine.data[1][1], comparison1],
							[combine.data[2][1], comparison2]
						]
					}]
				});
			});
		</script>
	</body>
</html>